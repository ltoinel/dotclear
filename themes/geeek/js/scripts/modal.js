// modal.js
!function(t){if(/^1\.(0|1)\./.test(t.fn.jquery)||/^1\.2\.(0|1|2|3|4|5)/.test(t.fn.jquery))throw"Modal requieres jQuery v1.2.6 or later. You are using v"+t.fn.jquery;t.modal=function(e,i){return this.params=t.extend(this.params,i),this.build(e)},t.modal.version="1.0",t.modal.prototype={params:{width:null,height:null,speed:300,opacity:.9,loader_img:"loader.gif",loader_txt:"loading...",close_img:"close.png",close_txt:"close",on_close:function(){}},ctrl:{box:t(),loader:t(),overlay:t('<div id="jq-modal-overlay"></div>'),hidden:t()},build:function(e){this.ctrl.loader=t('<div class="jq-modal-load"><img src="'+this.params.loader_img+'" alt="'+this.params.loader_txt+'" /></div>'),this.addOverlay();var i=this.getBoxSize(this.ctrl.loading);return this.ctrl.box=this.getBox(this.ctrl.loading,{top:Math.round(t(window).height()/2+t(window).scrollTop()-i.h/2),left:Math.round(t(window).width()/2+t(window).scrollLeft()-i.w/2),visibility:"hidden"}),this.ctrl.overlay.after(this.ctrl.box),void 0!=e&&(this.updateBox(e),this.data=e),this},updateBox:function(e,i){var o=this;this.hideCloser(),i=t.isFunction(i)?i:function(){};var a=t("div.jq-modal-content",this.ctrl.box);a.empty().append(this.ctrl.loader);var n=this.getBoxSize(e,this.params.width,this.params.height),r=Math.round(t(window).height()/2+t(window).scrollTop()-n.h/2),s=Math.round(t(window).width()/2+t(window).scrollLeft()-n.w/2);this.ctrl.box.css("visibility","visible").animate({top:0>r?0:r,left:0>s?0:s,width:n.w,height:n.h},this.params.speed,function(){o.setContentSize(a,o.params.width,o.params.height),a.empty().append(e).css("opacity",0).fadeTo(o.params.speed,1,function(){i.call(o,a)}),o.showCloser()})},getBox:function(e,i,o,a){var n=t('<div class="jq-modal"><div class="jq-modal-container"><div class="jq-modal-content"></div></div></div>').css(t.extend({position:"absolute",top:0,left:0,zIndex:100},i));return void 0!=e&&t("div.jq-modal-content",n).append(e),this.setContentSize(t("div.jq-modal-content",n),o,a),n},getBoxSize:function(t,e,i){var o=this.getBox(t,{visibility:"hidden"},e,i);this.ctrl.overlay.after(o);var a={w:o.width(),h:o.height()};return o.remove(),o=null,a},setContentSize:function(t,e,i){t.css({width:e>0?e:"auto",height:i>0?i:"auto"})},showCloser:function(){if(t("div.jq-modal-closer",this.ctrl.box).length>0)return void t("div.jq-modal-closer",this.ctrl.box).show();t("div.jq-modal-container",this.ctrl.box).append('<div class="jq-modal-closer"><a href="#">'+this.params.close_txt+"</a></div>");var e=this,i=t("div.jq-modal-closer a",this.ctrl.box);i.css({background:"transparent url("+this.params.close_img+") no-repeat"}).click(function(){return e.removeOverlay(),!1}),document.all&&(i[0].runtimeStyle.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+this.params.close_img+'", sizingMethod="crop")',i[0].runtimeStyle.backgroundImage="none")},hideCloser:function(){t("div.jq-modal-closer",this.ctrl.box).hide()},addOverlay:function(){var e=this;document.all&&(this.ctrl.hidden=t("select:visible, object:visible, embed:visible").css("visibility","hidden")),this.ctrl.overlay.css({backgroundColor:"#000",position:"absolute",top:0,left:0,zIndex:90,opacity:this.params.opacity}).appendTo("body").dblclick(function(){e.removeOverlay()}),this.resizeOverlay({data:this.ctrl}),t(window).bind("resize.modal",this.ctrl,this.resizeOverlay),t(document).bind("keypress.modal",this,this.keyRemove)},resizeOverlay:function(e){if(e.data.overlay.css({width:t(window).width(),height:t(document).height()}),e.data.box.parents("body").length>0){var i=Math.round(t(window).height()/2+t(window).scrollTop()-e.data.box.height()/2),o=Math.round(t(window).width()/2+t(window).scrollLeft()-e.data.box.width()/2);e.data.box.css({top:0>i?0:i,left:0>o?0:o})}},keyRemove:function(t){return 27==t.keyCode&&t.data.removeOverlay(),!0},removeOverlay:function(){t(window).unbind("resize.modal"),t(document).unbind("keypress"),this.params.on_close.apply(this),this.ctrl.overlay.remove(),this.ctrl.hidden.css("visibility","visible"),this.ctrl.box.remove(),this.ctrl.box=t()}}}(jQuery),function(t){t.fn.modalImages=function(e){e=t.extend(this.params,e);var i=new Array;return this.each(function(){if(""==t(this).attr("href")||void 0==t(this).attr("href")||"#"==t(this).attr("href"))return!1;var o=i.length;return i.push(t(this)),t(this).click(function(){return new t.modalImages(o,i,e),!1}),!0}),this},t.modalImages=function(e,i,o){this.links=i,this.modal=new t.modal(null,o),this.showImage(e)},t.modalImages.prototype={params:{prev_txt:"previous",next_txt:"next",prev_img:"prev.png",next_img:"next.png",blank_img:"blank.gif"},showImage:function(e){var i=this;t(document).unbind("keypress.modalImage"),void 0==this.links[e]&&this.modal.removeOverlay();var o=this.links[e],a=this.modal,n=t("<div></div>");n.append('<img src="'+o.attr("href")+'" alt="" />');var r=t("img:first",o);r.length>0&&r.attr("title")?n.append('<span class="jq-modal-legend">'+r.attr("title")+"</span>"):o.attr("title")&&n.append('<span class="jq-modal-legend">'+o.attr("title")+"</span>"),0!=e&&t('<a class="jq-modal-prev" href="#">prev</a>').appendTo(n),e+1<this.links.length&&t('<a class="jq-modal-next" href="#">next</a>').appendTo(n);var s=new Image;"visible"==this.modal.ctrl.box.css("visibility")?t("div.jq-modal-content",this.modal.ctrl.box).empty().append(this.modal.ctrl.loader):this.modal.updateBox(this.modal.ctrl.loader),s.onload=function(){a.updateBox(n,function(){var o=t("div.jq-modal-content img",this.ctrl.box);i.navBtnStyle(t("a.jq-modal-next",this.ctrl.box),!0).css("height",o.height()).bind("click",e+1,l),i.navBtnStyle(t("a.jq-modal-prev",this.ctrl.box),!1).css("height",o.height()).bind("click",e-1,l),o.click(function(){i.modal.removeOverlay()}),t(document).bind("keypress.modalImage",d)}),this.onload=function(){}},s.src=o.attr("href");var l=function(t){return i.showImage(t.data),!1},d=function(t){var o=String.fromCharCode(t.which).toLowerCase();("n"==o||39==t.keyCode)&&e+1<i.links.length&&i.showImage(e+1),"p"!=o&&37!=t.keyCode||0==e||i.showImage(e-1)}},navBtnStyle:function(e,i){var o="transparent url("+this.modal.params.blank_img+") repeat",a=i?this.modal.params.next_img:this.modal.params.prev_img,n=i?"right":"left";return e.css("background",o).bind("mouseenter",function(){t(this).css("background","transparent url("+a+") no-repeat center "+n).css("z-index",110)}).bind("mouseleave",function(){t(this).css("background",o)}),e}}}(jQuery),function(t){t.modalWeb=function(e,i,o){return iframe=t('<iframe src="'+e+'" frameborder="0">').css({border:"none",width:i,height:o}),new t.modal(iframe)},t.fn.modalWeb=function(e,i){this.click(function(){return void 0!=this.href&&t.modalWeb(this.href,e,i),!1})}}(jQuery);

